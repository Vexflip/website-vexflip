<header
  id="site-header"
  class="header top-0 fixed w-full z-30 bg-transparent text-white transition-colors duration-300 ease-in-out"
>
  <nav class="navbar container flex items-center justify-between">
    <!-- logo -->
    <div class="order-0">
      <a class="navbar-brand block" href="{{ site.Home.RelPermalink }}">
        <img
          id="logo-white"
          src="{{ "images/white-logo.png" | relURL }}"
          alt="Logo White"
          class="block h-12"
        />
        <img
          id="logo-default"
          src="{{ "images/logo.png" | relURL }}"
          alt="Logo Default"
          class="hidden h-12"
        />
      </a>
    </div>

    <!-- navbar toggler -->
    <input id="nav-toggle" type="checkbox" class="hidden" />
    <label
      for="nav-toggle"
      id="nav-toggler"
      class="order-3 cursor-pointer flex items-center lg:hidden text-white lg:order-1 transition-colors duration-300"
    >
      <svg id="show-button" class="h-6 fill-current block" viewBox="0 0 20 20">
        <title>Menu Open</title>
        <path d="M0 3h20v2H0V3z m0 6h20v2H0V9z m0 6h20v2H0V0z"></path>
      </svg>
      <svg id="hide-button" class="h-6 fill-current hidden" viewBox="0 0 20 20">
        <title>Menu Close</title>
        <polygon
          points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2"
          transform="rotate(45 10 10)"
        ></polygon>
      </svg>
    </label>

    <!-- main navbar -->
    <ul
      id="nav-menu"
      class="navbar-nav order-3 hidden lg:flex w-full pb-6 lg:order-1 lg:w-auto lg:space-x-2 lg:pb-0 xl:space-x-8 text-inherit"
    >
      {{ $currentPage := . }}
      {{ range site.Menus.main }}
        {{ $menuPage := site.GetPage .URL }}
        {{ $menuURL := "" }}
        {{ if $menuPage }}
          {{ $menuURL = $menuPage.RelPermalink }}
        {{ else }}
          {{ $menuURL = .URL }}
        {{ end }}
        {{ $currentPageURL := $currentPage.RelPermalink }}
        {{ $active := eq $menuURL $currentPageURL }}
        <li class="nav-item">
          <a
            class="nav-link px-3 py-2 rounded transition-colors duration-200 hover:bg-white/10
              {{ if $active }}font-bold underline{{ end }}"
            {{ if findRE `^http` .URL }}target="_blank" rel="noopener"{{ end }}
            href="{{ if findRE `^#` .URL }}
              {{ if not $.IsHome }}{{ site.Home.RelPermalink }}{{ end }}{{ .URL }}
            {{ else }}
              {{ if $menuPage }}{{ $menuPage.RelPermalink }}{{ else }}{{ .URL }}{{ end }}
            {{ end }}"
          >
            {{ .Name }}
          </a>
        </li>
      {{ end }}

      {{ if site.Params.navigation_button.enable }}
        <li class="mt-4 inline-block lg:hidden">
          <a
            class="btn btn-primary btn-sm"
            href="{{ site.Params.navigation_button.link | relLangURL }}"
          >
            {{ site.Params.navigation_button.label }}
          </a>
        </li>
      {{ end }}
    </ul>

    <!-- right-side buttons -->
    <div class="order-1 ml-auto flex items-center md:order-2 lg:ml-0">
      {{ with site.Params.search }}
        {{ if .enable }}
          <button
            aria-label="search"
            class="border-border text-white hover:text-primary mr-5 inline-block border-r pr-5 text-xl cursor-pointer
              {{ if not (or site.Params.navigation_button.enable site.Params.theme_switcher) }}
                lg:border-r-0 lg:pr-0
              {{ end }}"
            data-target="search-modal"
          >
            <i class="fa-solid fa-search"></i>
          </button>
        {{ end }}
      {{ end }}

      {{ partial "components/language-switcher" (dict "Context" . "Class" "mr-5 pl-2 py-1 rounded") }}

      {{ if site.Params.navigation_button.enable }}
        <a
          href="{{ site.Params.navigation_button.link | relLangURL }}"
          class="btn btn-primary btn-sm hidden lg:inline-block"
        >
          {{ site.Params.navigation_button.label }}
        </a>
      {{ end }}
    </div>
  </nav>

  <!-- STYLES -->
  <style>
    .nav-dropdown-list {
      display: none;
    }

    @media (min-width: 1024px) {
      .nav-dropdown:hover > .nav-dropdown-list {
        display: block !important;
      }
    }

    @media (max-width: 1023px) {
      li.nav-item.nav-dropdown.submenu-open > .nav-dropdown-list {
        display: block !important;
      }
    }

    /* Transparent header tweaks */
    #site-header.bg-transparent .btn-primary.btn-sm {
      background-color: white !important;
      color: #1e13c0 !important;
      border-color: white !important;
    }

    #site-header.bg-transparent .btn-primary.btn-sm:hover {
      background-color: #74a9f5;
      color: #1e13c0;
    }

    #site-header.bg-transparent .nav-link:hover {
      color: white !important;
      background-color: rgba(255, 255, 255, 0.1);
    }

    #site-header.bg-transparent .nav-link:hover svg {
      fill: white;
    }

    /* Blue background when mobile menu is open and transparent */
    #site-header.menu-open {
      background-color: rgb(36, 0, 77);
    }
  </style>

  <!-- SCRIPT -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const header = document.getElementById("site-header");
      const logoWhite = document.getElementById("logo-white");
      const logoDefault = document.getElementById("logo-default");
      const navToggle = document.getElementById("nav-toggle");
      const navToggler = document.getElementById("nav-toggler");
      const parentLinks = document.querySelectorAll(".parent-link");

      parentLinks.forEach((link) => {
        link.addEventListener("click", (e) => {
          if (navToggle.checked) {
            e.preventDefault();
            const parentLi = link.closest("li.nav-item.nav-dropdown");
            if (parentLi) {
              parentLi.classList.toggle("submenu-open");
            }
          }
        });
      });

      function updateHeaderState() {
        const scrolled = window.scrollY > 50;
        const menuOpen = navToggle.checked;

        if (scrolled) {
          header.classList.remove("bg-transparent", "text-white", "menu-open");
          header.classList.add("bg-white", "text-black", "shadow-md", "backdrop-blur-sm");
          logoWhite.classList.add("hidden");
          logoDefault.classList.remove("hidden");
          navToggler.classList.remove("text-white");
          navToggler.classList.add("text-primary");
        } else {
          header.classList.remove("bg-white", "text-black", "shadow-md", "backdrop-blur-sm");

          if (menuOpen) {
            header.classList.remove("bg-transparent");
            header.classList.add("menu-open", "text-white");
          } else {
            header.classList.add("bg-transparent", "text-white");
            header.classList.remove("menu-open");
          }

          logoWhite.classList.remove("hidden");
          logoDefault.classList.add("hidden");
          navToggler.classList.remove("text-primary");
          navToggler.classList.add("text-white");
        }
      }

      navToggle.addEventListener("change", updateHeaderState);
      window.addEventListener("scroll", updateHeaderState);
      updateHeaderState(); // Init
    });
  </script>
</header>
